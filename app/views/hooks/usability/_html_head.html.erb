<% defaults = Redmine::Plugin::registered_plugins[:usability].settings[:default] %>
<% settings = Setting.plugin_usability %>
<% all_settings = {} %>
<% defaults.each{|name, value| all_settings[name] = settings[name] || defaults[name]} %>
<% settings.each{|name, value| all_settings[name] = settings[name] || defaults[name]} %>

<%# Passing plugin settings from server to client %>
<script type="text/javascript">
// <![CDATA[
  RMPlus.Usability = (function(my){
    var my = my || {};

    my.settings = <%= all_settings.to_json.html_safe %>;

    return my;
  })(RMPlus.Usability || {});
// ]]>
</script>

<%= javascript_include_tag :raphael %>
<%= javascript_include_tag 'pie-chart', :plugin => :usability %>
<%= javascript_include_tag 'usability.js', :plugin => :usability %>
<%= stylesheet_link_tag 'usability.css', :plugin => :usability %>

<% if (!controller.nil? && controller.controller_name == 'settings' && controller.action_name == 'plugin') && params[:id] == 'usability' %>
  <%= stylesheet_link_tag 'settings', :plugin => 'a_common_libs', :media => 'screen' %>
<% end %>

